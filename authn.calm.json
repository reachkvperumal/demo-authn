{
  "$schema": "https://calm.finos.org/release/1.1/meta/calm.json",
  "unique-id": "passkey-webauthn-architecture",
  "name": "Passkey-WebAuthN-Architecture",
  "description": "Passwordless authentication using Passkeys and WebAuthn",
  "metadata": {
    "name": "Passkey-WebAuthN-Architecture",
    "description": "Passwordless authentication using Passkeys and WebAuthn",
    "owner": "Identity Team",
    "environment": "production",
    "costCenter": "CC-1234",
    "compliance": "PCI-DSS"
  },
  "nodes": [
    {
      "unique-id": "web-client",
      "type": "webclient",
      "node-type": "webclient",
      "name": "Web Client",
      "description": "Browser-based client that initiates passkey-based authentication using WebAuthn.",
      "metadata": [
        {
          "owner": "Identity Team",
          "environment": "production",
          "compliance": "PCI-DSS"
        }
      ]
    },
    {
      "unique-id": "api-gateway",
      "type": "service",
      "node-type": "service",
      "name": "API Gateway",
      "description": "Edge gateway that terminates HTTPS and forwards authentication requests to backend services.",
      "metadata": [
        {
          "owner": "Identity Team",
          "environment": "production",
          "compliance": "PCI-DSS"
        }
      ]
    },
    {
      "unique-id": "auth-service",
      "type": "service",
      "node-type": "service",
      "name": "Authentication Service",
      "description": "Core authentication service that verifies WebAuthn assertions, validates passkeys, and performs OIDC token exchange.",
      "metadata": [
        {
          "owner": "Identity Team",
          "environment": "production",
          "compliance": "PCI-DSS"
        }
      ],
      "interfaces": [
        {
          "unique-id": "webauthn",
          "interface-type": "WebAuthn"
        }
      ],
      "controls": {
        "tls": {
          "description": "Encrypt all inbound and outbound authentication traffic.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/TLS",
              "config": {
                "minimumVersion": "TLS1.2"
              }
            }
          ]
        },
        "zero-trust": {
          "description": "Use strong identity and continuous verification for service calls.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/ZeroTrust",
              "config": {
                "serviceIdentity": "mTLS",
                "leastPrivilege": true,
                "continuousVerification": true
              }
            }
          ]
        },
        "phishing-resistance": {
          "description": "Require WebAuthn authentication bound to relying party origin.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/PhishingResistance",
              "config": {
                "mechanism": "webauthn",
                "originBound": true,
                "userVerification": "required"
              }
            }
          ]
        }
      }
    },
    {
      "unique-id": "passkey-manager",
      "type": "service",
      "node-type": "service",
      "name": "Passkey Manager",
      "description": "Service responsible for passkey lifecycle management and validation support for WebAuthn.",
      "metadata": [
        {
          "owner": "Identity Team",
          "environment": "production",
          "compliance": "PCI-DSS"
        }
      ],
      "controls": {
        "tls": {
          "description": "Secure service-to-service communication with strong transport encryption.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/TLS",
              "config": {
                "mode": "mTLS"
              }
            }
          ]
        },
        "zero-trust": {
          "description": "Authorize requests using least privilege and continuous verification.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/ZeroTrust",
              "config": {
                "serviceIdentity": "mTLS",
                "leastPrivilege": true,
                "continuousVerification": true
              }
            }
          ]
        }
      }
    },
    {
      "unique-id": "identity-provider",
      "type": "service",
      "node-type": "service",
      "name": "Identity Provider",
      "description": "OIDC Identity Provider used for token issuance and identity federation.",
      "metadata": [
        {
          "owner": "Identity Team",
          "environment": "production",
          "compliance": "PCI-DSS"
        }
      ],
      "interfaces": [
        {
          "unique-id": "oidc",
          "interface-type": "OIDC"
        }
      ],
      "controls": {
        "tls": {
          "description": "Protect OIDC endpoints and token exchanges with TLS.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/TLS",
              "config": {
                "minimumVersion": "TLS1.2"
              }
            }
          ]
        },
        "zero-trust": {
          "description": "Ensure token exchanges are authorized and continuously verified.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/ZeroTrust",
              "config": {
                "leastPrivilege": true,
                "continuousVerification": true
              }
            }
          ]
        }
      }
    }
  ],
  "relationships": [
    {
      "unique-id": "web-client-to-api-gateway",
      "description": "Web Client sends authentication request to API Gateway.",
      "metadata": [
        {
          "criticality": "high"
        }
      ],
      "relationship-type": {
        "connects": {
          "source": {
            "node": "web-client"
          },
          "destination": {
            "node": "api-gateway"
          }
        }
      },
      "protocol": "HTTPS",
      "controls": {
        "tls": {
          "description": "Encrypt client-to-edge traffic.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/TLS",
              "config": {
                "minimumVersion": "TLS1.2"
              }
            }
          ]
        }
      }
    },
    {
      "unique-id": "api-gateway-to-auth-service",
      "description": "API Gateway forwards request to Authentication Service.",
      "metadata": [
        {
          "criticality": "high"
        }
      ],
      "relationship-type": {
        "connects": {
          "source": {
            "node": "api-gateway"
          },
          "destination": {
            "node": "auth-service"
          }
        }
      },
      "protocol": "HTTPS",
      "controls": {
        "tls": {
          "description": "Encrypt edge-to-service traffic.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/TLS",
              "config": {
                "minimumVersion": "TLS1.2"
              }
            }
          ]
        },
        "zero-trust": {
          "description": "Apply least privilege and continuous verification between gateway and auth service.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/ZeroTrust",
              "config": {
                "leastPrivilege": true,
                "continuousVerification": true
              }
            }
          ]
        }
      }
    },
    {
      "unique-id": "auth-service-to-passkey-manager",
      "description": "Authentication Service validates passkey using Passkey Manager.",
      "metadata": [
        {
          "criticality": "high",
          "sensitivity": "high"
        }
      ],
      "relationship-type": {
        "connects": {
          "source": {
            "node": "auth-service"
          },
          "destination": {
            "node": "passkey-manager"
          }
        }
      },
      "protocol": "mTLS",
      "controls": {
        "tls": {
          "description": "Require mutually authenticated TLS for passkey validation requests.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/TLS",
              "config": {
                "mode": "mTLS"
              }
            }
          ]
        },
        "zero-trust": {
          "description": "Enforce strong service identity and least privilege for passkey operations.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/ZeroTrust",
              "config": {
                "serviceIdentity": "mTLS",
                "leastPrivilege": true,
                "continuousVerification": true
              }
            }
          ]
        }
      }
    },
    {
      "unique-id": "auth-service-to-identity-provider",
      "description": "Authentication Service performs OIDC token exchange with Identity Provider.",
      "metadata": [
        {
          "criticality": "high",
          "sensitivity": "high",
          "applicationProtocol": "OIDC",
          "requestedProtocol": "HTTPS/OIDC"
        }
      ],
      "relationship-type": {
        "connects": {
          "source": {
            "node": "auth-service"
          },
          "destination": {
            "node": "identity-provider"
          }
        }
      },
      "protocol": "HTTPS",
      "controls": {
        "tls": {
          "description": "Protect token exchange with TLS.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/TLS",
              "config": {
                "minimumVersion": "TLS1.2"
              }
            }
          ]
        },
        "zero-trust": {
          "description": "Apply least privilege and continuous verification for token exchange.",
          "requirements": [
            {
              "requirement-url": "https://controls.calm.dev/ZeroTrust",
              "config": {
                "leastPrivilege": true,
                "continuousVerification": true
              }
            }
          ]
        }
      }
    }
  ],
  "controls": {
    "MFA": {
      "description": "Multi-factor authentication using passkeys/WebAuthn.",
      "requirements": [
        {
          "requirement-url": "https://controls.calm.dev/MFA",
          "config": {
            "appliedTo": "auth-flow-001"
          }
        }
      ]
    },
    "TLS": {
      "description": "Transport encryption for external and internal communication.",
      "requirements": [
        {
          "requirement-url": "https://controls.calm.dev/TLS",
          "config": {
            "appliedTo": "auth-flow-001"
          }
        }
      ]
    },
    "ZeroTrust": {
      "description": "Zero-trust controls for service-to-service calls.",
      "requirements": [
        {
          "requirement-url": "https://controls.calm.dev/ZeroTrust",
          "config": {
            "appliedTo": "auth-flow-001"
          }
        }
      ]
    },
    "PhishingResistance": {
      "description": "Phishing-resistant authentication using origin-bound WebAuthn passkeys.",
      "requirements": [
        {
          "requirement-url": "https://controls.calm.dev/PhishingResistance",
          "config": {
            "appliedTo": "auth-flow-001"
          }
        }
      ]
    }
  },
  "adrs": [
    "instructions/ADR-001.md",
    "instructions/ADR-002.md"
  ],
  "flows": [
    {
      "unique-id": "auth-flow-001",
      "name": "Authentication Flow",
      "description": "Sequence of steps for passwordless authentication using Passkeys and WebAuthn.",
      "transitions": [
        {
          "relationship-unique-id": "web-client-to-api-gateway",
          "sequence-number": 1,
          "description": "WebClient to APIGateway: Send authentication request",
          "direction": "source-to-destination"
        },
        {
          "relationship-unique-id": "api-gateway-to-auth-service",
          "sequence-number": 2,
          "description": "APIGateway to AuthService: Forward request",
          "direction": "source-to-destination"
        },
        {
          "relationship-unique-id": "auth-service-to-passkey-manager",
          "sequence-number": 3,
          "description": "AuthService to PasskeyManager: Validate passkey",
          "direction": "source-to-destination"
        },
        {
          "relationship-unique-id": "auth-service-to-identity-provider",
          "sequence-number": 4,
          "description": "AuthService to IdentityProvider: OIDC token exchange",
          "direction": "source-to-destination"
        },
        {
          "relationship-unique-id": "auth-service-to-identity-provider",
          "sequence-number": 5,
          "description": "IdentityProvider to AuthService: Return token",
          "direction": "destination-to-source"
        },
        {
          "relationship-unique-id": "api-gateway-to-auth-service",
          "sequence-number": 6,
          "description": "AuthService to APIGateway: Return response",
          "direction": "destination-to-source"
        },
        {
          "relationship-unique-id": "web-client-to-api-gateway",
          "sequence-number": 7,
          "description": "APIGateway to WebClient: Deliver authentication result",
          "direction": "destination-to-source"
        }
      ]
    }
  ]
}
